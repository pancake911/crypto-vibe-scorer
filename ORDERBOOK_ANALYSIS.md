# 盘口分析功能说明

## 📊 功能概述

新增了**自动盘口分析**模块，无需用户手动勾选，系统会自动分析Binance合约的深度数据，识别盘口特征。

---

## 🔍 分析逻辑

### 1. 假护盘/假压盘检测 (Spoofing/Wall)

**检测方法：**
- 检查前10档挂单数据
- 识别是否存在某个档位的挂单量特别巨大（超过其他档位平均值的5倍以上）

**输出：**
- 🔴 **假压盘**：检测到上方有巨额卖单墙（可能是假压盘）
- 🟡 **假护盘**：检测到下方有巨额买单墙（可能是假护盘）

**判断标准：**
- 单个档位挂单量 > 平均值 × 5
- 单个档位挂单量 > 100 BTC（避免误判小币种）

---

### 2. 真护盘/真压盘检测 (Ladder Support)

**检测方法：**
- 检查前5档的挂单分布
- 计算平均挂单量和标准差
- 判断是否分布均匀（变异系数 < 0.5）

**输出：**
- 🟢 **密集网格护盘**：检测到密集网格护盘（支撑强劲）
- 🟡 **密集网格压盘**：检测到密集网格压盘（上方压力大）

**判断标准：**
- 平均挂单量 > 500 BTC
- 变异系数 < 0.5（分布均匀）

---

### 3. 真空区/薄弱区检测 (Thin Liquidity)

**检测方法：**
- 计算前3档的总挂单量（买单+卖单）
- 判断是否低于阈值

**输出：**
- ⚠️ **盘口真空**：盘口真空（容易出现剧烈波动/插针）

**判断标准：**
- 前3档总挂单量 < 50 BTC

---

## 🎨 UI显示

### 盘口雷达区域
- 位置：在"恐惧贪婪指数"下方，独立区域显示
- 更新频率：每3秒自动刷新
- 显示内容：
  - 分析结果标签（带图标和颜色）
  - 风险等级（高风险/中风险/低风险）
  - 相关价格（如果检测到异常大单）

### 颜色编码
- 🔴 红色：假压盘、盘口真空（高风险）
- 🟡 黄色：假护盘、密集网格压盘（中风险）
- 🟢 绿色：密集网格护盘（低风险）
- ℹ️ 灰色：盘口正常

---

## 🔧 技术实现

### API路由
- **路径**: `/api/orderbook`
- **数据源**: Binance Futures API
- **接口**: `GET /fapi/v1/depth?symbol={SYMBOL}USDT&limit=20`
- **功能**: 获取前20档深度数据并转发给前端

### 分析函数
- **文件**: `lib/orderbook-analysis.ts`
- **函数**: `analyzeOrderBook(bids, asks)`
- **输入**: 买单深度数组、卖单深度数组
- **输出**: 分析结果数组

### 自动刷新
- 使用 `setInterval` 每3秒刷新一次
- 切换代币时自动重置定时器
- 组件卸载时清理定时器

---

## 📝 使用说明

1. **自动运行**：选择代币后，盘口分析自动开始
2. **实时更新**：每3秒自动刷新数据和分析结果
3. **切换代币**：切换代币时，自动重置并开始新的分析
4. **无需操作**：完全自动化，无需手动操作

---

## ⚠️ 注意事项

1. **数据延迟**：Binance API可能有轻微延迟（通常<1秒）
2. **网络问题**：如果网络不稳定，可能无法获取数据
3. **误判可能**：算法基于统计规律，可能存在误判
4. **仅供参考**：分析结果仅供参考，不构成投资建议

---

## 🚀 未来改进

- [ ] 增加更多检测模式
- [ ] 支持自定义阈值
- [ ] 历史数据对比
- [ ] 盘口可视化图表
- [ ] 多交易所数据对比

---

**最后更新**: 2025年1月

